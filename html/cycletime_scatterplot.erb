<h1>Cycletime Scatterplot</h1>
<p>
  This chart shows only completed work and indicates both what day it completed as well as how many days it took to get done. Hovering over a dot will show you the ID of the work item.
</p>
<p>
  The red line indicates the 85th percentile (<%= percent_line %> days). 85% of all items on this chart fall on or below the line and the remaining 15% are above the line. 85% is a reasonable proxy for "most" so that we can say that based on this data set, we can predict that most work of this type will complete in <%= percent_line %> days or less.
</p>
<div>
  <canvas id="<%= chart_id %>" width="800" height="200"></canvas>
</div>
<script>
new Chart(document.getElementById('<%= chart_id %>').getContext('2d'), {
  type: 'scatter',
  data: {
    datasets: <%= JSON.generate(data_sets) %>
  },
  options: {
    title: {
      display: true,
      text: "Cycletime Scatterplot"
    },
    responsive: true, // If responsive is true then it fills the screen
    scales: {
      x: {
        type: "time",
        scaleLabel: {
          display: true,
          labelString: 'Date Completed'
        }
      },
      y: {
        scaleLabel: {
          display: true,
          labelString: 'Days'
        }
      }
    },
    plugins: {
      tooltip: {
        callbacks: {
          label: function(context) {
            return context.dataset.data[context.dataIndex].title
          }
        }
      },
      autocolors: false,
      annotation: {
        annotations: {
          line1: {
            type: 'line',
            yMin: <%= percent_line %>,
            yMax: <%= percent_line %>,
            borderColor: 'rgb(255, 99, 132)',
            borderWidth: 1
          }
        }
      }
    }
  }
});
</script>
<% unless stopped_but_not_started.empty? %>
  <p>
    <b>Data quality note:</b> <%= stopped_but_not_started.size %> items were discarded from this data set. Although they did complete in the time period shown here, we were unable to determine when they started and therefore couldn't calculate cycle time. Most likely, these items moved directly from Created to Done.
    <%= collapsible_issues_panel stopped_but_not_started %>
  </p>
<% end %>

