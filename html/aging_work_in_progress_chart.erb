<h1>Aging Work in Progress</h1>
<p>This chart shows only work items that have started but not completed, grouped by the column they're currently in. Hovering over a dot will show you the ID of that work item.</p>
<p>The gray area indicates the 85% mark for work items that have passed through here - 85% of previous work items left this column while still inside the gray area. Any work items above the gray area are outliers and they are the items that you should pay special attention to.</p>
<div>
  <canvas id="<%= chart_id %>" width="800" height="200"></canvas>
</div>
<script>
new Chart(document.getElementById(<%= chart_id.inspect %>).getContext('2d'),
{
  type: 'bar',
  data: {
    labels: [<%= column_headings.collect(&:inspect).join(',') %>],
    datasets: <%= JSON.generate(data_sets) %>
  },
  options: {
    title: {
      display: true,
      text:    "Aging work in progress"
    },
    responsive: true, // If responsive is true then it fills the screen
    scales: {
      x: {
        scaleLabel: {
          display: true,
          labelString: 'Date Completed'
        }
      },
      y: {
        scaleLabel: {
          display: true,
          labelString: 'Days'
        }
      }
    },
    plugins: {
      tooltip: {
        callbacks: {
          label: function(context) {
            if( typeof(context.dataset.data[context.dataIndex]) == "number" ) {
              return "85% of the issues, leave this column in "+context.dataset.data[context.dataIndex]+" days";
            }
            else {
              return context.dataset.data[context.dataIndex].title
            }
          }
        }
      }
    }
  }
});
</script>
